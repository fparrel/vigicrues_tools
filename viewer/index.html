<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head></head>
<body>
<div id="stations">
</div>
</body>
<script>

function getStations(domain) {
    request.open("GET", "stations_"+domain+".json", false);
    request.send(null);
    return JSON.parse(request.responseText);
}

function addToRiver(station, contents) {
    if (typeof(rivers[stations[i].river])==='undefined') {
        rivers[stations[i].river] = contents;
    } else {
        rivers[stations[i].river] += contents;
    }
}

var request = new XMLHttpRequest();
var i;
var html = '<ul>';
var rivers = {};

var domain = 'vigicrues';
var stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    addToRiver(stations[i],
              '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].id+'">'+stations[i].name+' (Hauteur)</a></li>'
            + '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].id+'-q">'+stations[i].name+' (Débit)</a></li>');
}

domain = 'rdbrmc';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    if (stations[i].type==='PLUVIO') {
        contents = '<li><a href="viewer.html?domain='+domain+'&station_id=pluie_'+stations[i].id+'">'+stations[i].name+' (Pluie)</a></li>';
    } else {
        contents = '<li><a href="viewer.html?domain='+domain+'&station_id=cote_'+stations[i].id+'">'+stations[i].name+' (Cote)</a></li>'
                 + '<li><a href="viewer.html?domain='+domain+'&station_id=debit_'+stations[i].id+'">'+stations[i].name+' (Débit)</a></li>';
    }
    addToRiver(stations[i], contents);
}

domain = 'chtajo';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    addToRiver(stations[i], '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].id+'">'+stations[i].name+' (Débit)</a></li>');
}

domain = 'chduero';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    addToRiver(stations[i], '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].id+'">'+stations[i].station+' (Débit)</a></li>');
}

domain = 'chebro';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    addToRiver(stations[i], '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].id+'">'+stations[i].desc+' (Debit)</a></li>');
}

domain = 'chguadiana';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    addToRiver(stations[i], '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].type+'_'+stations[i].id+'">'+stations[i].name+' </a></li>');
}

domain = 'chcantabrico';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    addToRiver(stations[i], '<li><a href="viewer.html?domain='+domain+'&station_id=nivel_'+stations[i].id+'">'+stations[i].name+' </a></li>');
}

domain = 'chmino';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    var j;
    for(j=0;j<stations[i].tags.length;j++) {
        addToRiver(stations[i], '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].tags[j]+'">'+stations[i].name+' </a></li>');
    }
}

domain = 'chgalicia';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    addToRiver(stations[i], '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].id+'">'+stations[i].name+' </a></li>');
}

domain = 'chj';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    addToRiver(stations[i], '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].id+'">'+stations[i].name+' </a></li>');
}


domain = 'chguadalquivir';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    addToRiver(stations[i], '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].id+'">'+stations[i].desc+' </a></li>');
}

domain = 'gencat';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    addToRiver(stations[i], '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].net+stations[i].id+'-'+stations[i].ids+'">'+stations[i].name+' </a></li>');
}

domain = 'hidrosur';
stations = getStations(domain);
for(i=0;i<stations.length;i++) {
    var j;
    for(j=0;i<stations[i].measures;j++) {
        addToRiver(stations[i], '<li><a href="viewer.html?domain='+domain+'&station_id='+stations[i].measures[j].id+'">'+stations[i].name+': '+stations[i].measures[j].name+' </a></li>');
    }
}

var rivers_sorted = Object.keys(rivers);
rivers_sorted.sort(function (a, b) {
    return a.toLowerCase().localeCompare(b.toLowerCase());
});
for(var i=0;i<rivers_sorted.length;i++) {
    html += '<li>' + rivers_sorted[i] + ': <ul>' + rivers[rivers_sorted[i]] + '</ul></li>';
}
html+='</ul>';
document.getElementById("stations").innerHTML = html;
</script>
</html>

